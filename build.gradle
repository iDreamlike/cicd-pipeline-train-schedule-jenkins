plugins {
  id "com.moowork.node" version "1.3.1"
  id 'io.jumpco.open.gradle.s3' version '1.2.4'
}


node {
  download = true
}

def getDate() {
    return new Date().format('yyyyMMddHHmmss')
}

task build


task zip(type: Zip){

		from ('.') {
			include "*"

			include "bin/**"
			include "data/**"
			include "node_modules/**"
			include "routes/**"
			include "views/**"
			include "public/**"
		}
		destinationDir(file("dist"))
		baseName "TrainShedule" + getDate()
}

s3 {
    awsAccessKeyId = 'AKIAUSONYJ6RYIYHRNUA'
    awsSecretAccessKey = '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'
    region = 'us-west-2'
    bucket = "gradle-backet"
}

task S3Up (type: io.jumpco.open.gradle.s3.S3Upload) {
              key = zip.baseName+".zip"
              file = "${projectDir}/dist/"+zip.baseName+".zip"
      }


build.dependsOn S3Up
S3Up.dependsOn zip
build.dependsOn zip
zip.dependsOn npm_build
build.dependsOn npm_build
npm_build.dependsOn npm_install
// npm_build.dependsOn npm_update
npm_build.dependsOn npm_test
npm_test.dependsOn npm_install
